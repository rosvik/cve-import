# cve-import

A tool to import CVE records to a database from json files. CVE JSON files are fetched from [CVEProject/cvelistV5](https://github.com/CVEProject/cvelistV5).

## Setup

- Clone the repo and install packages with `yarn`
- Copy `.env.sample` to `.env`, and enter your Postgres credentials.
- Run `yarn migrate` to apply the prisma schema to you database.
- Clone [cvelistV5](https://github.com/CVEProject/cvelistV5) into an adjacent folder of cve-import (`../cvelistV5` relative to this README).

## Updating database schema

- Run `npx prisma migrate dev`
- Check status with `npx prisma migrate status`

### Troubleshooting

If the prisma schema has been updated, and the prisma client is out of sync, you might need to reinstall prisma. `rm -rf node_modules && yarn` should do the trick.

## Writing to database

There are three modes of operation, each can be run with `yarn <mode>`:

### `populate`

To build the database from scratch, when there is no pre-existing data. Remember to run `yarn migrate` first.

```bash
yarn populate
```

### `iterate`

To walk the git tree of cvelistV5 and import any changes from new commits. Existing records are updated, and new records are added. This can be slow if there are many commits to walk through, so if it has been several weeks since the last update, it might be faster to use `update` instead.

```bash
yarn iterate
```

### `update`

To update a pre-existing database with new data if it is very outdated, or you want to verify that every record is synced to your cvelistV5 copy. This is is slow and inefficient, so it shouldn't be used regularly. Supports optional parameter `--start-at` if you want to resume a previous run at document number N.

```bash
yarn update --start-at 10000
```

### `get`

To fetch a single CVE record from the database and print it to stdout. Specify the CVE ID as a parameter.

```bash
yarn get CVE-2022-40982
```
