import ajv from "ajv";

import { v4Metaschema } from "./examples/v4-metaschema";

import { v4SchemaReserved } from "./examples/v4-schema-reserved";
import { v4SchemaPublic } from "./examples/v4-schema-public";
import { v4SchemaReject } from "./examples/v4-schema-reject";

import { v4ExampleReserved } from "./examples/v4-example-reserved";
import { v4ExamplePublic } from "./examples/v4-example-public";
import { v4ExampleReject } from "./examples/v4-example-reject";

// v5.0 metaschema already exists
import { v5Metaschema } from "./examples/v5-metaschema";
import { v5SchemaBundled } from "./examples/v5-schema-bundled";
import { v5ExamplePublished } from "./examples/v5-example-published";

export function getValidator(
  version: "v5" | "v4-reserved" | "v4-public" | "v4-reject"
) {
  const Ajv = new ajv();

  Ajv.addMetaSchema(v5Metaschema);
  Ajv.addMetaSchema(v4Metaschema);

  if (version === "v5") {
    return Ajv.compile(v5SchemaBundled);
  } else if (version === "v4-reserved") {
    return Ajv.compile(v4SchemaReserved);
  } else if (version === "v4-public") {
    return Ajv.compile(v4SchemaPublic);
  } else if (version === "v4-reject") {
    return Ajv.compile(v4SchemaReject);
  }

  console.warn("Warning: None schema returned");
  return Ajv.compile({});
}

function main() {
  const validateV5 = getValidator("v5");
  const validateV4Reserved = getValidator("v4-reserved");
  const validateV4Public = getValidator("v4-public");
  const validateV4Reject = getValidator("v4-reject");

  console.log(`v5ExamplePublished ${validateV5(v5ExamplePublished)}`);
  console.log(`v4ExampleReserved ${validateV4Reserved(v4ExampleReserved)}`);
  console.log(`v4ExamplePublic ${validateV4Public(v4ExamplePublic)}`);
  console.log(`v4ExampleReject ${validateV4Reject(v4ExampleReject)}`);
}

main();
