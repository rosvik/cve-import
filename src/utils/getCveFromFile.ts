import { readFileSync } from "fs";
import { DbRow } from "../types/types";
import { has } from "./has";

export function getCveFromFile(path: string): DbRow | undefined {
  const fileContents = readFileSync(path);
  const j = JSON.parse(fileContents.toString());
  if (!(typeof j === "object")) return;

  const read_cve = j;
  if (!has("cveMetadata", read_cve)) return;
  const meta = read_cve.cveMetadata;
  if (!(typeof meta === "object" && meta)) return;

  if (!has("cveId", meta)) return;
  const id = meta.cveId;
  if (!(typeof id === "string")) return;

  return {
    id,
    json: j,
  };
}
